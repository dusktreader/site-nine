# Task BLD-H-0037: Implement epic markdown artifact generation and templates

**Status:** COMPLETE
**Priority:** HIGH
**Role:** Builder
**Category:** feature
**Mission:** 
**Claimed:** 2026-02-04 15:43:52
**Actual Time:** 
**Closed:** 2026-02-04 15:46:29
**Paused:** 
## Objective

Create epic markdown templates in .opencode/work/epics/, implement artifact generation with progress tracking and subtask tables

## Problem Statement

Epics existed in the database but had no markdown file representation. Unlike tasks which have detailed .md files in `.opencode/work/tasks/`, epics lacked persistent documentation artifacts that could be read, edited, and tracked in version control.

## Implementation Steps

### Implementation (2026-02-04)

1. **Created epic markdown sync system** (src/site_nine/cli/epic.py)
   - Added `_sync_epic_file()` helper function (lines 430-540) to generate markdown from database
   - Follows same pattern as `_sync_task_file()` from task CLI
   - Preserves existing body content when re-syncing (only updates header)

2. **Implemented rich markdown template** with multiple sections:
   - **Header**: Epic ID, title, status emoji (üìã TODO, üöß UNDERWAY, ‚úÖ COMPLETE, ‚ùå ABORTED)
   - **Metadata**: Status, priority, created/updated/completed/aborted timestamps
   - **Progress section**: Task completion stats and visual progress bar
   - **Subtasks table**: Markdown table with task ID, title, status emoji, role, priority
   - **Body template**: Description, Goals, Success Criteria, Notes sections

3. **Added `s9 epic sync` command** (lines 387-423)
   - Syncs single epic: `s9 epic sync --epic EPC-H-0001`
   - Syncs all epics: `s9 epic sync`
   - Creates `.opencode/work/epics/` directory if needed
   - Uses path validation to prevent directory traversal

4. **Integrated auto-sync into all epic operations**:
   - `s9 epic create`: Auto-generates markdown file after database creation
   - `s9 epic update`: Syncs markdown after database update
   - `s9 epic abort`: Updates markdown to show ABORTED status

5. **Added progress bar helper** (`_generate_progress_bar()` at line 541)
   - Generates visual progress bar: `[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 40%`
   - Configurable width (default 30 characters)

### Design Decisions

- **Status emojis**: Visual indicators make status immediately clear (üìã üöß ‚úÖ ‚ùå)
- **Subtask status emojis**: Each status has unique emoji (‚¨ú TODO, üîµ UNDERWAY, ‚úÖ COMPLETE, etc.)
- **Preserve body content**: Only header is regenerated on sync, body content is preserved
- **Database as source of truth**: Markdown files are generated from database, not vice versa
- **Markdown tables**: Subtasks displayed as GitHub-flavored markdown tables for compatibility

## Files Changed

### Modified
- `src/site_nine/cli/epic.py`:
  - Added import for `validate_path_within_project` (line 16)
  - Modified `create` command to auto-sync (lines 88-93)
  - Modified `update` command to sync after update (lines 316-322)
  - Modified `abort` command to sync after abort (lines 379-386)
  - Added `sync` command (lines 387-423)
  - Added `_sync_epic_file()` helper (lines 430-540)
  - Added `_generate_progress_bar()` helper (line 541-545)

## Testing Performed

All functionality tested with real epics:

```bash
# Test 1: Sync existing epics
s9 epic sync
# Result: ‚úì Synced 2 epic(s)
#   Created EPC-H-0001.md and EPC-H-0002.md

# Verify EPC-H-0002.md content
cat .opencode/work/epics/EPC-H-0002.md
# Result: Shows header with status, progress bar, subtasks table, template body

# Test 2: Auto-generation on create
s9 epic create --title "Markdown Generation Test" --priority MEDIUM --description "Test automatic markdown generation on epic creation"
# Result: ‚úì Created epic EPC-M-0003
#   File auto-generated: EPC-M-0003.md

# Verify auto-generated file
cat .opencode/work/epics/EPC-M-0003.md
# Result: Shows complete markdown with description in body

# Test 3: Sync specific epic
s9 epic sync --epic EPC-H-0002
# Result: ‚úì Synced epic EPC-H-0002
```

**Markdown features verified**:
- ‚úÖ Status emojis (üìã TODO, ‚ùå ABORTED)
- ‚úÖ Progress bar visual representation
- ‚úÖ Subtasks table with all linked tasks
- ‚úÖ Metadata (created, updated, completed, aborted timestamps)
- ‚úÖ Template sections (Description, Goals, Success Criteria, Notes)
- ‚úÖ Body content preservation on re-sync

## Notes

- Epic markdown files use `.opencode/work/epics/` directory (parallel to `.opencode/work/tasks/`)
- File path stored in database epic.file_path field
- Markdown generation happens automatically on create/update/abort, or manually via `s9 epic sync`
- Progress bar and subtask table update automatically when epic status changes
- Compatible with GitHub markdown rendering (uses standard table syntax)