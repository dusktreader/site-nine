# Task OPR-H-0016: Make s9 agent end command the source of truth for session status

**Status:** COMPLETE
**Priority:** HIGH
**Role:** Operator
**Category:** infrastructure
**Agent:** 23
**Claimed:** 2026-02-02 21:44:39
**Actual Time:** 
**Closed:** 2026-02-02 21:48:00
**Paused:** 
## Objective

Currently agents can manually edit session file YAML frontmatter (status, end_time) without running 's9 agent end', causing database and file to get out of sync. This leads to orphaned sessions that appear active in the database but are marked completed in files.

Solution: Make 's9 agent end' the single source of truth by:
1. Update the command to modify both database AND session file frontmatter atomically
2. Remove manual frontmatter editing from session-end skill instructions
3. Document that only 's9 agent end' should update session status
4. Optionally add validation that warns if file/DB status mismatch detected

Files to modify:
- src/s9/cli/agent.py (agent end command)
- .opencode/skills/session-end/SKILL.md (remove manual YAML editing steps)
- Documentation to clarify proper session closure workflow

Benefits:
- Prevents orphaned sessions (like cronos, erebus, atlas from Feb 1)
- Single atomic operation updates both file and database
- No more manual YAML editing = less room for error
- Consistent state between markdown files and database

## Problem Statement

[Describe the problem or need - explain current state, why it's problematic, impact]

## Implementation Steps

[Chronological log of work done - update as you go, document decisions]

## Files Changed

### Created
- [file path] - [description]

### Modified
- [file path] - [description]

## Testing Performed

[Document test commands, results, verification]

## Notes

[Progress notes, questions, blockers]