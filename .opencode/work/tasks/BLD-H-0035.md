# Task BLD-H-0035: Implement epic CLI commands (create, list, show, update, abort)

**Status:** COMPLETE
**Priority:** HIGH
**Role:** Builder
**Category:** feature
**Mission:** 
**Claimed:** 2026-02-04 15:38:57
**Actual Time:** 
**Closed:** 2026-02-04 15:41:43
**Paused:** 
## Objective

Create s9 epic subcommands: create, list, show, update, abort with interactive confirmation for abort

## Problem Statement

The epic management system had database models and manager functions (src/site_nine/epics/) but no CLI interface for users to interact with epics. Agents needed a command-line interface to create, list, view, update, and abort epics.

## Implementation Steps

### Implementation (2026-02-04)

1. Created `src/site_nine/cli/epic.py` with comprehensive CLI commands following the established pattern from other CLI modules (review.py, task.py)

2. Implemented five commands:
   - `s9 epic create`: Create new epic with title, priority, and optional description
   - `s9 epic list`: List epics with optional status/priority filters, shows progress
   - `s9 epic show`: Display detailed epic information including all subtasks
   - `s9 epic update`: Update epic title, description, or priority
   - `s9 epic abort`: Abort epic with confirmation prompt (can skip with --yes flag)

3. Registered epic CLI module in `src/site_nine/cli/main.py` to make commands available via `s9 epic`

4. Created database migration `004_add_epics_table.sql` to add epics table and triggers to existing databases (table was in schema.sql but not in production databases)

5. Applied migration to add:
   - `epics` table with full schema
   - Database triggers for auto-updating epic status based on subtasks
   - `epic_id` column to tasks table for linking
   - Indexes for performance

### Design Decisions

- **Interactive confirmation for abort**: Abort command shows warning with list of affected tasks and requires confirmation (unless --yes flag provided)
- **Color-coded output**: Status displayed with colors (TODO=yellow, UNDERWAY=cyan, COMPLETE=green, ABORTED=red)
- **Progress display**: Shows task completion as "N/M (X%)" for epics with tasks
- **Subtask display**: `show` command includes table of all linked tasks with their status

## Files Changed

### Created
- `src/site_nine/cli/epic.py` - Complete epic CLI module with all 5 commands
- `.opencode/work/migrations/004_add_epics_table.sql` - Database migration for adding epics table and triggers

### Modified
- `src/site_nine/cli/main.py` - Registered epic CLI commands in main app (line 48, 64)

## Testing Performed

All commands tested successfully:

```bash
# Create epic
s9 epic create --title "Test Epic System" --priority HIGH --description "Testing epic creation and commands"
# Result: ✓ Created epic EPC-H-0001

# List epics
s9 epic list
# Result: Table showing 1 epic with status, priority, progress

# Show details
s9 epic show EPC-H-0001
# Result: Full epic details including description and timestamps

# Update epic
s9 epic update EPC-H-0001 --title "Updated Epic Title"
# Result: ✓ Updated epic EPC-H-0001

# Abort epic
s9 epic abort EPC-H-0001 --reason "Testing abort functionality" --yes
# Result: ✓ Aborted epic EPC-H-0001, status changed to ABORTED

# Verify abort
s9 epic show EPC-H-0001
# Result: Shows ABORTED status with abort timestamp and reason
```

All commands working as expected with proper error handling, validation, and user feedback.

## Notes

- Epic ID generation was already implemented in `src/site_nine/epics/epic_ids.py` (completed in BLD-H-0034)
- Migration required because epics table was added to schema.sql on 2026-02-03 but existing databases didn't have it
- Abort command includes double safety: CLI confirmation prompt + agent should ask user
- Epic manager and models include comprehensive test coverage (31 passing tests)