# Task ENG-H-0036: Implement task-epic linking (create with --epic, link, unlink)

**Status:** COMPLETE
**Priority:** HIGH
**Role:** Engineer
**Category:** feature
**Mission:** 
**Claimed:** 2026-02-04 15:41:51
**Actual Time:** 
**Closed:** 2026-02-04 15:43:43
**Paused:** 
## Objective

Add --epic flag to task create, implement task link/unlink commands to move tasks between epics

## Problem Statement

Tasks could be created but had no way to associate them with epics at creation time or link/unlink them afterward. The EpicManager had `link_task` and `unlink_task` methods, but no CLI interface exposed this functionality.

## Implementation Steps

### Implementation (2026-02-04)

1. **Modified `s9 task create` command** (src/site_nine/cli/task.py:274-358)
   - Added `--epic` / `-e` parameter to accept epic ID
   - After task creation, if epic ID provided, link task using EpicManager
   - Displays confirmation message when linked
   - Handles errors gracefully (e.g., epic not found)

2. **Added `s9 task link` command** (src/site_nine/cli/task.py:908-933)
   - Takes task ID and epic ID as arguments
   - Verifies task exists before attempting link
   - Uses EpicManager.link_task() to create association
   - Displays success message with both IDs

3. **Added `s9 task unlink` command** (src/site_nine/cli/task.py:936-964)
   - Takes only task ID as argument
   - Checks if task is currently linked to an epic
   - If not linked, displays friendly message and returns
   - Uses EpicManager.unlink_task() to remove association
   - Shows which epic was unlinked from

### Design Decisions

- **Import EpicManager inline**: Imported `from site_nine.epics import EpicManager` within functions to avoid circular dependencies
- **Graceful error handling**: Invalid epic IDs show warning but don't fail task creation
- **User feedback**: All operations provide clear confirmation messages
- **No epic update on unlink**: Removed task becomes independent, doesn't get deleted

## Files Changed

### Modified
- `src/site_nine/cli/task.py` - Added --epic flag to create (line 307-311), added link command (908-933), added unlink command (936-964)

## Testing Performed

All functionality tested with real data:

```bash
# Create epic for testing
s9 epic create --title "Task Linking Test Epic" --priority HIGH --description "Epic for testing task linking functionality"
# Result: ✓ Created epic EPC-H-0002

# Test 1: Create task with --epic flag
s9 task create --title "Test task 1" --role Engineer --priority HIGH --epic EPC-H-0002
# Result: ✓ Created task ENG-H-0059: Test task 1
#         Linked to epic: EPC-H-0002

# Test 2: Create task without epic, then link
s9 task create --title "Test task 2" --role Engineer --priority MEDIUM
# Result: ✓ Created task ENG-M-0060: Test task 2

s9 task link ENG-M-0060 EPC-H-0002
# Result: ✓ Linked task ENG-M-0060 to epic EPC-H-0002

# Verify epic shows both tasks
s9 epic show EPC-H-0002
# Result: Shows 2 subtasks (ENG-H-0059 and ENG-M-0060)

# Test 3: Unlink task
s9 task unlink ENG-M-0060
# Result: ✓ Unlinked task ENG-M-0060 from epic EPC-H-0002

# Verify task removed from epic
s9 epic show EPC-H-0002
# Result: Shows only 1 subtask (ENG-H-0059)
```

All operations completed successfully with proper validation and user feedback.

## Notes

- EpicManager already had link_task/unlink_task methods (implemented in task ENG-H-0034)
- Task creation with --epic flag is atomic - task gets created even if epic linking fails
- Unlinking from epic leaves task in its current state (status, priority, etc. unchanged)
- Epic status triggers auto-update when tasks are linked/unlinked (handled by database triggers)