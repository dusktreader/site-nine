---
from_role: Inspector
from_name: argus
to_role: Engineer
task_id: ENG-H-0021
priority: HIGH
created_at: 2026-02-02 11:41:32
status: pending
---

# Handoff: Replace Local File Dependency with PyPI typerdrive

**From:** Inspector (Argus)  
**To:** Engineer  
**Task:** ENG-H-0021 - Replace local file dependency with PyPI typerdrive  
**Priority:** HIGH  
**Created:** 2026-02-02 11:41:32

---

## Summary

During my comprehensive security audit, I discovered a **CRITICAL portability issue** in `pyproject.toml` line 14. The project uses a local file dependency that prevents installation on any machine except the original developer's workstation. This must be fixed before the project can be published or used by others.

## The Problem

**File:** `pyproject.toml` line 14  
**Current Code:**
```toml
"typerdrive @ file:///Users/tucker.beck/src/dusktreader/typerdrive",
```

**Impact:**
- âŒ Project cannot be installed on other machines
- âŒ Breaks CI/CD pipelines
- âŒ Prevents PyPI publication
- âŒ Blocks user installations via `pip install site-nine`

## The Solution

Replace the local file reference with the PyPI package.

**Required Changes:**

1. **Check PyPI for latest version:**
   ```bash
   pip index versions typerdrive
   # or visit: https://pypi.org/project/typerdrive/
   ```

2. **Update pyproject.toml line 14:**
   ```toml
   # Change from:
   "typerdrive @ file:///Users/tucker.beck/src/dusktreader/typerdrive",
   
   # To:
   "typerdrive>=0.7.0",  # Use actual latest version from PyPI
   ```

3. **Update uv.lock:**
   ```bash
   uv lock --upgrade-package typerdrive
   ```

4. **Test in clean environment:**
   ```bash
   # Create fresh venv
   uv venv --python 3.13 test-env
   
   # Activate and install
   source test-env/bin/activate
   uv pip install -e .
   
   # Verify it works
   s9 --version
   s9 agent roles
   ```

## Files to Modify

**Primary:**
- `pyproject.toml` (line 14) - Replace local path with PyPI version

**Auto-generated (will update automatically):**
- `uv.lock` - Will regenerate when you run `uv lock`

## Acceptance Criteria

- [ ] `pyproject.toml` no longer contains `file://` references
- [ ] `uv.lock` updated successfully
- [ ] Project installs cleanly in fresh virtual environment
- [ ] All CLI commands work after fresh install (`s9 --version`, `s9 agent roles`, etc.)
- [ ] No import errors or missing dependencies
- [ ] Tests run successfully (if test execution is fixed by then)

## Additional Context

**Why this happened:**  
During development, you were likely testing changes to `typerdrive` locally and used a file reference for quick iteration. This is fine for development but needs to be changed before release.

**Verification:**
After making the change, you can verify portability by:
```bash
# On a different machine or clean checkout:
git clone <repo>
cd site-nine
uv venv
uv pip install -e .
s9 --version  # Should work!
```

## Notes

- typerdrive is maintained by the same author (dusktreader), so it should be on PyPI
- If for some reason typerdrive is NOT on PyPI, use a git reference instead:
  ```toml
  "typerdrive @ git+https://github.com/dusktreader/typerdrive.git@main"
  ```
- This is a **blocking issue** for any public release
- The fix is simple but critical!

## Related Tasks

- OPR-H-0018: Fix test execution problems (may be related to dependency issues)
- ENG-M-0020: Refactor long functions (lower priority, do after this)

---

**Inspector's Note:** This is the most critical finding from my audit. Everything else in the codebase is excellent from a security and quality standpoint. Fix this one issue and you're ready for public release! ðŸ¦š
